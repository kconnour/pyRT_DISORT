
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The aerosol module &#8212; pyRT_DISORT  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'rst/for-users/tutorials/spacecraft_retrieval/aerosol';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
  
    <p class="title logo__title">pyRT_DISORT  documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api-reference.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about-this-project/about-pyRT_DISORT.html">
                        About pyRT_DISORT
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about-this-project/about-DISORT.html">
                        About DISORT
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about-this-project/release-notes.html">
                        Release notes
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/kconnour/pyRT_DISORT" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api-reference.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about-this-project/about-pyRT_DISORT.html">
                        About pyRT_DISORT
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about-this-project/about-DISORT.html">
                        About DISORT
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about-this-project/release-notes.html">
                        Release notes
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/kconnour/pyRT_DISORT" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">The aerosol module</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="the-aerosol-module">
<h1>The aerosol module<a class="headerlink" href="#the-aerosol-module" title="Permalink to this heading">#</a></h1>
<p>We just created 3 arrays for Rayleigh scattering; now, we need to make the same
arrays for dust.</p>
<section id="conrath">
<h2>Conrath<a class="headerlink" href="#conrath" title="Permalink to this heading">#</a></h2>
<p>First, we need to define a vertical volumetric mixing ratio profile for dust.
A Conrath profile was invented specifically for Martian dust, so let’s use
<code class="xref py py-class docutils literal notranslate"><span class="pre">Conrath</span></code> to make the profile. For our retrieval, this
profile will be used to define the aerosol weighting within the <em>layers</em>. Let’s
assume the midpoint altitudes are a good representation of the layer altitudes
and construct them here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z_midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_grid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">z_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>
</div>
<p>We can then set the Conrath parameters, and access the profile via the class
property</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyRT_DISORT.aerosol</span> <span class="kn">import</span> <span class="n">Conrath</span>

<span class="n">q0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">H</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">conrath</span> <span class="o">=</span> <span class="n">Conrath</span><span class="p">(</span><span class="n">z_midpoint</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>

<span class="n">dust_profile</span> <span class="o">=</span> <span class="n">conrath</span><span class="o">.</span><span class="n">profile</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This module also comes with <code class="xref py py-class docutils literal notranslate"><span class="pre">Uniform</span></code> to make constant
mixing ratio profiles. This may be more applicable to water-ice clouds so we
won’t use it here, but it’s worth mentioning its existence.</p>
</div>
</section>
<section id="forwardscattering">
<h2>ForwardScattering<a class="headerlink" href="#forwardscattering" title="Permalink to this heading">#</a></h2>
<p>The last preparation step we need to do is define the aerosol’s forward
scattering properties. I assume that all forward scattering properties are a
function of both particle size and wavelength.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have properties that aren’t a function of both particle size and
wavelength, you can use functions like
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.broadcast_to.html">np.broadcast_to()</a>
to make the arrays of the proper shape.</p>
</div>
<p>I include some dust scattering properties in the tests directory, so let’s get
them, along with the grid over which they’re defined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>

<span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;~/pyRT_DISORT/tests/aux/dust_properties.fits&#39;</span>
<span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">cext</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">csca</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">wavs</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;wavelengths&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">psizes</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;particle_sizes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<p>Now, we simply need to define a grid of particle sizes where to get these
properties (and the wavelengths too, but we already defined these). We should
also define the wavelength reference—the wavelength to scale the extinction cross section.
This value will come in handy when creating the optical depth profile.</p>
<p>Finally, the particle sizes and wavelengths at which the properties are defined
aren’t necessarily the ones we want to use, so we also need to include a grid
of particle sizes and wavelengths to regrid the forward scattering properties
onto. We can do this with <code class="xref py py-class docutils literal notranslate"><span class="pre">ForwardScattering</span></code>.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The particle size grid should be the same shape as the number of layers in
the model. That’s to say, each layer should have an associated particle
size.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">particle_size_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">wave_ref</span> <span class="o">=</span> <span class="mf">9.3</span>

<span class="kn">from</span> <span class="nn">pyRT_DISORT.aerosol</span> <span class="kn">import</span> <span class="n">ForwardScattering</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">ForwardScattering</span><span class="p">(</span><span class="n">csca</span><span class="p">,</span> <span class="n">cext</span><span class="p">,</span> <span class="n">psizes</span><span class="p">,</span> <span class="n">wavs</span><span class="p">,</span> <span class="n">particle_size_grad</span><span class="p">,</span>
                       <span class="n">pixel_wavelengths</span><span class="p">,</span> <span class="n">wave_ref</span><span class="p">)</span>
</pre></div>
</div>
<p>Before calling any methods, <code class="docutils literal notranslate"><span class="pre">fs</span></code> simply holds on to the inputs. It’s now our
job to tell it <em>how</em> to grid the forward scattering properties onto this new
grid. Perhaps you want nearest neighbor interpolation, perhaps you want linear
interpolation, or perhaps you want something fancier. Just call the method that
tells it how to do the interpolation and then you can access the computed
properties. Here, I’ll use nearest neighbor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span><span class="o">.</span><span class="n">make_nn_properties</span><span class="p">()</span>

<span class="n">nn_sca_cs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">scattering_cross_section</span>
<span class="n">nn_ext_cs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">extinction_cross_section</span>
<span class="n">dust_ssa</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">single_scattering_albedo</span>
<span class="n">dust_ext</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">extinction</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>If you don’t call a method, all of the properties will be empty arrays.</p>
</div>
<p>We’ve now defined the single scattering albedo at the nearest neighbor grid
points. Since we have the extinction (<code class="docutils literal notranslate"><span class="pre">dust_ext</span></code>) we can create the optical
depth array.</p>
</section>
<section id="opticaldepth">
<h2>OpticalDepth<a class="headerlink" href="#opticaldepth" title="Permalink to this heading">#</a></h2>
<p>Now that we have the extinction profile from <code class="code docutils literal notranslate"><span class="pre">fs</span></code>, we can make the array
of optical depth with <code class="xref py py-class docutils literal notranslate"><span class="pre">OpticalDepth</span></code>. I’ll plug in everything
and let it calculate. Essentially, all it needs to know to compute the optical
depth is the the vertical mixing ratio profile along with the column density in
each layer. It’ll allocate the optical such that the total optical depth sums
up to the column integrated optical depth (which I set to 1 here), and is then
scaled to the reference wavelength that extinction was computed for (here,
9.3 microns when making <code class="docutils literal notranslate"><span class="pre">dust_ext</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyRT_DISORT.aerosol</span> <span class="kn">import</span> <span class="n">OpticalDepth</span>

<span class="n">od</span> <span class="o">=</span> <span class="n">OpticalDepth</span><span class="p">(</span><span class="n">dust_profile</span><span class="p">,</span> <span class="n">hydro</span><span class="o">.</span><span class="n">column_density</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">extinction</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">dust_od</span> <span class="o">=</span> <span class="n">od</span><span class="o">.</span><span class="n">total</span>
</pre></div>
</div>
<p>With that, we computed the optical depth.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As before, if you want to see the total optical depth due to dust at the
input wavelengths, you can execute the line</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dust_od</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>to see the column integrated optical depth. For this example it gives
<code class="docutils literal notranslate"><span class="pre">[1.89162754</span> <span class="pre">1.93270736</span> <span class="pre">1.55633803</span> <span class="pre">1.16197183</span> <span class="pre">0.76995305]</span></code>. This is
just the ratio of the extinction coefficient at the wavelength divided by
the extinction coefficient at the reference wavelength, summed over all the
layers.</p>
</div>
</section>
<section id="tabularlegendrecoefficients">
<h2>TabularLegendreCoefficients<a class="headerlink" href="#tabularlegendrecoefficients" title="Permalink to this heading">#</a></h2>
<p>Now, we just need to make the phase function, which we can do with
<code class="xref py py-class docutils literal notranslate"><span class="pre">TabularLegendreCoefficients</span></code>. This class will essentially work
the same way that <code class="docutils literal notranslate"><span class="pre">ForwardScattering</span></code> did—it will simply hang on to an
array of Legendre coefficients, the grid over which they’re defined, and the
grid to regrid them onto. Let’s go ahead and do that here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyRT_DISORT.aerosol</span> <span class="kn">import</span> <span class="n">TabularLegendreCoefficients</span>

<span class="n">dust_phsfn_file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;~/pyRT_DISORT/tests/aux/dust_phase_function.fits&#39;</span><span class="p">)</span>
<span class="n">coeff</span> <span class="o">=</span> <span class="n">dust_phsfn_file</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">pf_wavs</span> <span class="o">=</span> <span class="n">dust_phsfn_file</span><span class="p">[</span><span class="s1">&#39;wavelengths&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">pf_psizes</span> <span class="o">=</span> <span class="n">dust_phsfn_file</span><span class="p">[</span><span class="s1">&#39;particle_sizes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="n">pf</span> <span class="o">=</span> <span class="n">TabularLegendreCoefficients</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">pf_psizes</span><span class="p">,</span> <span class="n">pf_wavs</span><span class="p">,</span>
                                 <span class="n">particle_size_grad</span><span class="p">,</span> <span class="n">pixel_wavelengths</span><span class="p">)</span>
</pre></div>
</div>
<p>Like before, there are multiple ways to do the regridding. I’ll again go with
nearest neighbor, then access the phase function via the property.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pf</span><span class="o">.</span><span class="n">make_nn_phase_function</span><span class="p">()</span>

<span class="n">dust_pf</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">phase_function</span>
</pre></div>
</div>
<p>To recap, we regridded the forward scattering properties to a grid via
nearest neighbor interpolation, which gave us the dust single scattering
albedo. We made vertical profile for dust, and with the nearest neighbor
extinction profile we computed the optical depth. Finally, we used nearest
neighbor interpolation to get the Legendre coefficients on our grid. We now
computed all of the arrays for dust!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example I used the tabulated Legendre coefficients from an empirical
phase function, but suppose you want to use an analytic phase function like
Henyey-Greenstein. In this case the Legendre coefficients are determined
by the asymmetry parameter at particle sizes and wavelengths. You’d want to
turn the asymmetry parameter into Legendre coefficients (see
<code class="xref py py-class docutils literal notranslate"><span class="pre">HenyeyGreenstein</span></code> to do this). After doing this we have an
array that’s functionally identical to the empirical coefficients we defined
above—Legendre coefficients and the particle size and wavelength grid over
which they’re defined, so you can put the newly created Legendre coefficient
array into <code class="docutils literal notranslate"><span class="pre">TabularLegendreCoefficients</span></code> and be good to go.</p>
</div>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conrath">Conrath</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forwardscattering">ForwardScattering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#opticaldepth">OpticalDepth</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tabularlegendrecoefficients">TabularLegendreCoefficients</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../../../_sources/rst/for-users/tutorials/spacecraft_retrieval/aerosol.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, kconnour.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>